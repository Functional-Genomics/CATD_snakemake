## Psuedobulk generation module for the deconvolution benchmarking pipeline
##
## @zgr2788
##
##
## Description:
##
## Takes a SeuratObject as input ('{input}_gen.rds' as part of pipeline) and
## generates psuedobulks with the given parameters. If reproducability is
## desired, the seeded version of the rule should be used, which is essentially
## the same code with a seed of '42'.
## TODO:
## - Add parameterization
## - Add mode 2
## - Add all parameters to config
## - Add proportions - DONE
## - Add seeded/unseeded - DONE
##
##
##
##

rule generatePsuedobulks:
    input:
        'Input/Cell_splits/{sample}_gen.rds'

    output:
        'Input/Psuedobulks/{sample}_pbulks.rds',
        'Input/Psuedobulks/{sample}_props.rds'

    conda:
        "env.yaml"

    shell:
        'Rscript Modules/Psuedobulk/randomGen.R Input/Cell_splits/{wildcards.sample}_gen.rds 1 1000 5'



rule generateSeededPsuedobulks:
    input:
        'Input/Cell_splits/{sample}_gen_seeded.rds'

    output:
        'Input/Psuedobulks/{sample}_pbulks_seeded.rds',
        'Input/Psuedobulks/{sample}_props_seeded.rds'

    conda:
        "env.yaml"

    shell:
        'Rscript Modules/Psuedobulk/randomGen_seeded.R Input/Cell_splits/{wildcards.sample}_gen.rds 1 1000 5'
